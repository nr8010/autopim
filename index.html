<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Automotive PIM – Prototype</title>
  <style>
    :root {
      --bg: #0f172a;          /* slate-900 */
      --panel: #111827;       /* gray-900 */
      --muted: #1f2937;       /* gray-800 */
      --text: #e5e7eb;        /* gray-200 */
      --text-dim: #9ca3af;    /* gray-400 */
      --brand: #22d3ee;       /* cyan-400 */
      --accent: #a78bfa;      /* violet-400 */
      --ok: #34d399;          /* emerald-400 */
      --warn: #fbbf24;        /* amber-400 */
      --err: #fb7185;         /* rose-400 */
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }
    [data-theme="light"]{
      --bg: #f8fafc;          /* slate-50 */
      --panel: #ffffff;       /* white */
      --muted: #f1f5f9;       /* slate-100 */
      --text: #0f172a;        /* slate-900 */
      --text-dim: #475569;    /* slate-600 */
      --shadow: 0 8px 24px rgba(2,6,23,.08);
    }
    * { box-sizing: border-box }
    html, body { height: 100% }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
      Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji; background: var(--bg);
      color: var(--text);
    }
    .app { display: grid; grid-template-columns: 280px 1fr; grid-template-rows: 64px 1fr; height: 100%; }
    header { grid-column: 1 / -1; display:flex; align-items:center; gap:16px; padding: 12px 16px; background: transparent; }
    .logo { display:flex; align-items:center; gap:10px; font-weight:700; }
    .logo svg { width: 28px; height: 28px }
    .topbar { margin-left:auto; display:flex; gap:12px; align-items:center }
    .btn { background: var(--muted); color: var(--text); border: 1px solid rgba(255,255,255,.06); padding: 10px 14px; border-radius: 12px; cursor: pointer; transition:.2s; }
    .btn:hover { transform: translateY(-1px); box-shadow: var(--shadow); }
    .btn.primary { background: linear-gradient(135deg, var(--brand), var(--accent)); color:#000; border: none }
    .badge { padding: 3px 8px; border-radius: 999px; font-size: 12px; background: var(--muted); color: var(--text-dim) }

    aside { background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0)); border-right: 1px solid rgba(255,255,255,.06); padding: 14px; }
    .nav h4 { margin:14px 8px; color: var(--text-dim); font-weight:600; font-size:12px; letter-spacing:.08em; text-transform:uppercase }
    .nav a { display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius: 12px; color: var(--text); text-decoration:none; border:1px solid transparent }
    .nav a:hover { background: var(--muted); border-color: rgba(255,255,255,.06) }
    .nav a.active { background: var(--panel); border-color: rgba(255,255,255,.12) }

    main { padding: 18px; overflow:auto }
    .grid { display:grid; grid-template-columns: repeat(12, 1fr); gap: 16px }
    .card { background: var(--panel); border:1px solid rgba(255,255,255,.06); border-radius: var(--radius); box-shadow: var(--shadow); }
    .card .content { padding: 16px }
    .kpi { display:flex; align-items:center; justify-content:space-between }
    .kpi h2 { margin:0; font-size: 14px; color: var(--text-dim); font-weight:600 }
    .kpi .value { font-size:26px; font-weight:800 }

    .toolbar { display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom: 10px }
    input[type="text"], select { background: var(--muted); color: var(--text);
      border: 1px solid rgba(255,255,255,.08); border-radius: 12px; padding: 10px 12px; outline:none; }
    input[type="file"]{ color: var(--text-dim) }

    table { width: 100%; border-collapse: collapse; overflow: hidden; border-radius: var(--radius) }
    thead { background: rgba(255,255,255,.03) }
    th, td { text-align:left; padding: 12px 10px; border-bottom: 1px dashed rgba(255,255,255,.06) }
    tbody tr:hover { background: rgba(255,255,255,.03) }
    .status { font-size:12px; padding: 4px 8px; border-radius: 999px; }
    .s-ok{ background: rgba(52,211,153,.15); color: var(--ok) }
    .s-warn{ background: rgba(251,191,36,.15); color: var(--warn) }
    .s-err{ background: rgba(251,113,133,.15); color: var(--err) }

    .footer { display:flex; justify-content:space-between; align-items:center; color: var(--text-dim); font-size: 12px; margin-top: 16px }

    dialog { border:none; border-radius: 16px; padding:0; background: var(--panel); color: var(--text); box-shadow: var(--shadow); width: min(720px, 92vw) }
    dialog::backdrop{ background: rgba(2,6,23,.6) }
    .modal-header{ display:flex; align-items:center; justify-content:space-between; padding: 14px 16px; border-bottom: 1px solid rgba(255,255,255,.06) }
    .modal-body{ padding:16px; display:grid; gap:12px }
    .modal-actions{ display:flex; justify-content:flex-end; gap:10px; padding: 14px 16px; border-top: 1px solid rgba(255,255,255,.06) }
    .row{ display:grid; grid-template-columns: 1fr 1fr; gap: 12px }
    .row-3{ display:grid; grid-template-columns: repeat(3,1fr); gap:12px }
    .field label{ display:block; font-size:12px; color: var(--text-dim); margin-bottom:6px }
    .field input, .field select, .field textarea { width:100%; padding:10px 12px; border-radius: 12px; border:1px solid rgba(255,255,255,.08); background: var(--muted); color: var(--text) }
    .field small{ color: var(--text-dim) }

    /* Responsiveness */
    @media (max-width: 1024px){ .app { grid-template-columns: 80px 1fr } .nav span.txt{ display:none } }
    @media (max-width: 720px){ header{ flex-wrap:wrap } .row, .row-3{ grid-template-columns:1fr } .toolbar{ flex-direction:column; align-items:stretch } }
  </style>
</head>
<body>
<div id="root" class="app" data-theme="dark">
  <header>
    <div class="logo">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path d="M3 12h4l2 3h6l2-3h4"/>
        <circle cx="12" cy="18" r="3"/>
        <circle cx="6" cy="18" r="2"/>
        <circle cx="18" cy="18" r="2"/>
      </svg>
      <span>Automotive PIM</span>
      <span class="badge" id="envBadge">Demo</span>
    </div>

    <div class="topbar">
      <input id="q" type="text" placeholder="Suche nach Produkt, OEM, EAN…" />
      <button class="btn" id="btnLang">DE</button>
      <button class="btn" id="btnTheme">Dark</button>
      <button class="btn primary" id="btnNew">+ Neues Produkt</button>
    </div>
  </header>

  <aside>
    <nav class="nav">
      <h4>Navigation</h4>
      <a href="#" class="active" data-section="dashboard">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 3h7v9H3zM14 3h7v5h-7zM14 12h7v9h-7zM3 16h7v5H3z"/></svg>
        <span class="txt">Dashboard</span>
      </a>
      <a href="#" data-section="products">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 16V8l-9-5-9 5v8l9 5 9-5z"/></svg>
        <span class="txt">Produkte</span>
      </a>
      <a href="#" data-section="media">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 5h18v14H3z"/><path d="M3 15l5-5 4 4 3-3 4 4"/></svg>
        <span class="txt">Medien</span>
      </a>
      <a href="#" data-section="exports">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 3v12"/><path d="M8 7l4-4 4 4"/><path d="M5 21h14"/></svg>
        <span class="txt">Exporte</span>
      </a>
      <a href="#" data-section="settings">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06A2 2 0 1 1 7.04 3.3l.06.06c.47.47 1.14.65 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09c0 .68.26 1.35.73 1.82l.06.06a2 2 0 1 1 2.83 2.83l-.06.06c-.47.47-.65 1.14-.33 1.82V10c.68 0 1.35.26 1.82.73l.06.06A2 2 0 1 1 20.7 16.7l-.06-.06a1.65 1.65 0 0 0-1.24-.64z"/></svg>
        <span class="txt">Einstellungen</span>
      </a>
    </nav>
  </aside>

  <main>
    <!-- KPIs -->
    <div class="grid" style="margin-bottom: 12px">
      <div class="card" style="grid-column: span 3">
        <div class="content kpi"><h2>Produkte</h2><div class="value" id="kpiProducts">1 248</div></div>
      </div>
      <div class="card" style="grid-column: span 3">
        <div class="content kpi"><h2>Medien</h2><div class="value" id="kpiMedia">5 973</div></div>
      </div>
      <div class="card" style="grid-column: span 3">
        <div class="content kpi"><h2>Datenqualität</h2><div class="value" id="kpiDQ">92%</div></div>
      </div>
      <div class="card" style="grid-column: span 3">
        <div class="content kpi"><h2>Offene Prüfungen</h2><div class="value" id="kpiOpen">17</div></div>
      </div>
    </div>

    <!-- Toolbar -->
    <div class="card" style="margin-bottom: 12px">
      <div class="content">
        <div class="toolbar">
          <input id="filterText" type="text" placeholder="Filter: Artikelnummer / Bezeichnung / OEM…" />
          <select id="selBrand"><option value="">Marke (alle)</option><option>ACME</option><option>FastParts</option><option>Headline</option></select>
          <select id="selStatus"><option value="">Status (alle)</option><option>Aktiv</option><option>In Prüfung</option><option>Gesperrt</option></select>
          <button class="btn" id="btnAudit">Audit Log</button>
          <button class="btn" id="btnImport">Import</button>
          <button class="btn" id="btnExport">Export</button>
        </div>

        <div style="overflow:auto">
          <table id="tbl">
            <thead>
              <tr>
                <th style="width: 130px">Artikel</th>
                <th>Bezeichnung</th>
                <th style="width: 110px">Marke</th>
                <th style="width: 160px">TecDoc</th>
                <th style="width: 140px">Preis (€)</th>
                <th style="width: 110px">Status</th>
                <th style="width: 120px">Aktionen</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="footer">
          <span id="rowCount">0 Einträge</span>
          <div>
            <span>Seite</span>
            <select id="selPage"></select>
          </div>
        </div>
      </div>
    </div>

    <!-- Media Upload -->
    <div class="card">
      <div class="content">
        <h3 style="margin-top:0">Medienverwaltung</h3>
        <div class="row">
          <div class="field">
            <label>Datei hochladen</label>
            <input id="fileInput" type="file" multiple accept="image/*" />
            <small>Hinweis: Bilder werden anhand des Dateinamens automatisch Produkten zugeordnet (z. B. <code>12345_front.jpg</code> → Artikel 12345).</small>
          </div>
          <div>
            <button class="btn" id="btnProcess">Dateien verarbeiten</button>
          </div>
        </div>
        <div id="uploadLog" style="margin-top:10px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px; color: var(--text-dim)"></div>
      </div>
    </div>
  </main>
</div>

<!-- MODALS -->
<dialog id="modalNew">
  <div class="modal-header">
    <strong>Neues Produkt anlegen</strong>
    <button class="btn" onclick="closeDialog('modalNew')">×</button>
  </div>
  <div class="modal-body">
    <div class="row">
      <div class="field"><label>Artikelnummer</label><input id="mSku" placeholder="z. B. 12345" /></div>
      <div class="field"><label>Marke</label>
        <select id="mBrand"><option>ACME</option><option>FastParts</option><option>Headline</option></select>
      </div>
    </div>
    <div class="field"><label>Bezeichnung (DE)</label><input id="mNameDE" placeholder="z. B. Bremsbelag-Satz VA" /></div>
    <div class="field"><label>Bezeichnung (EN)</label><input id="mNameEN" placeholder="e.g. Brake pad set, front" /></div>
    <div class="row-3">
      <div class="field"><label>EAN</label><input id="mEan" placeholder="z. B. 4021234567890" /></div>
      <div class="field"><label>Preis (€)</label><input id="mPrice" type="number" step="0.01" placeholder="0.00" /></div>
      <div class="field"><label>Status</label><select id="mStatus"><option>Aktiv</option><option>In Prüfung</option><option>Gesperrt</option></select></div>
    </div>
    <div class="field"><label>TecDoc Verknüpfung</label><input id="mTecdoc" placeholder="KTyp / LinkageId / MFR-Model" /></div>
    <div class="field"><label>Beschreibung</label><textarea id="mDesc" rows="3" placeholder="Kurzbeschreibung, Material, Einbauhinweise…"></textarea></div>
  </div>
  <div class="modal-actions">
    <button class="btn" onclick="closeDialog('modalNew')">Abbrechen</button>
    <button class="btn primary" onclick="createProduct()">Anlegen</button>
  </div>
</dialog>

<dialog id="modalExport">
  <div class="modal-header">
    <strong>Export</strong>
    <button class="btn" onclick="closeDialog('modalExport')">×</button>
  </div>
  <div class="modal-body">
    <div class="row-3">
      <div class="field"><label>Format</label>
        <select id="exFormat"><option value="csv">CSV</option><option value="xlsx">Excel</option><option value="pdf">PDF</option><option value="taf">TecDoc TAF</option><option value="bmecat">BMEcat</option></select>
      </div>
      <div class="field"><label>Sprache</label>
        <select id="exLang"><option>DE</option><option>EN</option><option>FR</option><option>IT</option><option>ZH</option></select>
      </div>
      <div class="field"><label>Umfang</label>
        <select id="exScope"><option value="all">Alle Produkte</option><option value="filtered">Gefilterte Ansicht</option><option value="changed">Seit letztem Export geändert</option></select>
      </div>
    </div>
    <div class="field"><label>Bemerkung</label><input id="exNote" placeholder="z. B. Preisupdate Q3" /></div>
  </div>
  <div class="modal-actions">
    <button class="btn" onclick="closeDialog('modalExport')">Schließen</button>
    <button class="btn primary" onclick="fakeExport()">Export starten</button>
  </div>
</dialog>

<script>
  // --- State ---
  const state = {
    theme: localStorage.getItem('pim_theme') || 'dark',
    lang: localStorage.getItem('pim_lang') || 'DE',
    pageSize: 8,
    products: generateSeed(57)
  };

  // --- Init ---
  const root = document.getElementById('root');
  root.setAttribute('data-theme', state.theme);
  document.getElementById('btnTheme').textContent = state.theme === 'dark' ? 'Dark' : 'Light';
  document.getElementById('btnLang').textContent = state.lang;

  const tbody = document.querySelector('#tbl tbody');
  const selPage = document.getElementById('selPage');
  const filterText = document.getElementById('filterText');
  const selBrand = document.getElementById('selBrand');
  const selStatus = document.getElementById('selStatus');

  function applyFilters(){
    const f = filterText.value.toLowerCase();
    const b = selBrand.value;
    const s = selStatus.value;
    const filtered = state.products.filter(p => {
      const textMatch = !f || [p.sku, p.nameDE, p.oem, p.ean].some(x => (x+"").toLowerCase().includes(f));
      const brandMatch = !b || p.brand === b;
      const statusMatch = !s || p.status === s;
      return textMatch && brandMatch && statusMatch;
    });
    renderTable(filtered);
  }

  function renderTable(rows){
    const pages = Math.max(1, Math.ceil(rows.length / state.pageSize));
    selPage.innerHTML = Array.from({length: pages}, (_,i)=>`<option>${i+1}</option>`).join('');
    const current = Number(selPage.value || 1) - 1;
    const start = current * state.pageSize;
    const view = rows.slice(start, start + state.pageSize);
    tbody.innerHTML = view.map(tr => `
      <tr>
        <td><strong>${tr.sku}</strong><div style="color:var(--text-dim); font-size:12px">${tr.ean}</div></td>
        <td>${tr.nameDE}<div style="color:var(--text-dim); font-size:12px">OEM: ${tr.oem}</div></td>
        <td>${tr.brand}</td>
        <td>${tr.tecdoc}</td>
        <td>${tr.price.toFixed(2)}</td>
        <td><span class="status ${cls(tr.status)}">${tr.status}</span></td>
        <td>
          <button class="btn" onclick="edit('${tr.sku}')">Bearbeiten</button>
          <button class="btn" onclick="del('${tr.sku}')">Löschen</button>
        </td>
      </tr>`).join('');
    document.getElementById('rowCount').textContent = `${rows.length} Einträge`;
  }

  function cls(s){ return s === 'Aktiv' ? 's-ok' : s === 'In Prüfung' ? 's-warn' : 's-err' }

  // Seed data
  function generateSeed(n){
    const brands = ['ACME', 'FastParts', 'Headline'];
    const statuses = ['Aktiv', 'In Prüfung', 'Gesperrt'];
    const out = [];
    for(let i=0;i<n;i++){
      const sku = String(12000 + i);
      out.push({
        sku,
        nameDE: `Bremsbelag-Satz ${i%2? 'VA':'HA'}`,
        ean: `40212${(100000 + i).toString()}`,
        oem: `OE${1000+i}`,
        tecdoc: `KTyp ${5000+i}`,
        brand: brands[i%brands.length],
        price: 9.9 + (i%13)*2.35,
        status: statuses[i%statuses.length]
      });
    }
    return out;
  }

  // Navigation
  document.querySelectorAll('aside .nav a').forEach(a=>{
    a.addEventListener('click', e=>{
      e.preventDefault();
      document.querySelectorAll('aside .nav a').forEach(x=>x.classList.remove('active'));
      a.classList.add('active');
      const sec = a.dataset.section;
      alert(`Sektion "${sec}" – Platzhalter in dieser Demo.`)
    })
  })

  // Listeners
  [filterText, selBrand, selStatus].forEach(el=>el.addEventListener('input', applyFilters));
  selPage.addEventListener('change', applyFilters);

  document.getElementById('btnTheme').addEventListener('click', ()=>{
    state.theme = state.theme === 'dark' ? 'light' : 'dark';
    localStorage.setItem('pim_theme', state.theme);
    root.setAttribute('data-theme', state.theme);
    document.getElementById('btnTheme').textContent = state.theme === 'dark' ? 'Dark' : 'Light';
  })

  document.getElementById('btnLang').addEventListener('click', ()=>{
    const langs = ['DE','EN','FR','IT','ZH'];
    const idx = langs.indexOf(state.lang);
    state.lang = langs[(idx+1)%langs.length];
    localStorage.setItem('pim_lang', state.lang);
    document.getElementById('btnLang').textContent = state.lang;
  })

  document.getElementById('btnNew').addEventListener('click', ()=> openDialog('modalNew'));
  document.getElementById('btnExport').addEventListener('click', ()=> openDialog('modalExport'));
  document.getElementById('btnImport').addEventListener('click', ()=> alert('Importer: CSV, Excel, TAF (TecDoc), BMEcat – Platzhalter.'));
  document.getElementById('btnAudit').addEventListener('click', ()=> alert('Audit Log – Platzhalter in dieser Demo.'));

  // File processing demo (auto-link images to products via filename)
  document.getElementById('btnProcess').addEventListener('click', ()=>{
    const files = document.getElementById('fileInput').files;
    if(!files.length) return toast('Keine Dateien ausgewählt.');
    const log = [];
    for(const f of files){
      const match = /([0-9]{5})/i.exec(f.name);
      const sku = match ? match[1] : null;
      if(sku && state.products.some(p=>p.sku===sku)){
        log.push(`✔ ${f.name} → Artikel ${sku}`)
      } else {
        log.push(`✖ ${f.name} → kein passender Artikel`)
      }
    }
    document.getElementById('uploadLog').innerText = log.join('\n');
    toast('Dateien verarbeitet.');
  })

  // Modals
  function openDialog(id){ document.getElementById(id).showModal() }
  function closeDialog(id){ document.getElementById(id).close() }
  window.closeDialog = closeDialog;

  function createProduct(){
    const sku = document.getElementById('mSku').value.trim();
    if(!sku){ toast('Artikelnummer erforderlich'); return }
    const prod = {
      sku,
      nameDE: document.getElementById('mNameDE').value || '(ohne Titel)',
      ean: document.getElementById('mEan').value || '-',
      oem: 'OE' + Math.floor(1000+Math.random()*9000),
      tecdoc: document.getElementById('mTecdoc').value || '-',
      brand: document.getElementById('mBrand').value,
      price: Number(document.getElementById('mPrice').value || 0),
      status: document.getElementById('mStatus').value
    };
    state.products.unshift(prod);
    applyFilters();
    closeDialog('modalNew');
    toast('Produkt angelegt');
  }

  function edit(sku){ toast(`Bearbeiten ${sku} – Platzhalter`) }
  function del(sku){
    if(confirm(`Produkt ${sku} löschen?`)){
      state.products = state.products.filter(p=>p.sku!==sku);
      applyFilters();
      toast('Produkt gelöscht');
    }
  }

  function fakeExport(){
    const fmt = document.getElementById('exFormat').value;
    const scope = document.getElementById('exScope').value;
    toast(`Export gestartet: ${fmt.toUpperCase()} (${scope})`);
    closeDialog('modalExport');
  }

  // Simple toast
  let toastTO;
  function toast(msg){
    clearTimeout(toastTO);
    let el = document.getElementById('toast');
    if(!el){
      el = document.createElement('div');
      el.id = 'toast';
      el.style.position='fixed'; el.style.bottom='20px'; el.style.right='20px';
      el.style.background='var(--panel)'; el.style.border='1px solid rgba(255,255,255,.12)';
      el.style.padding='10px 14px'; el.style.borderRadius='12px'; el.style.boxShadow='var(--shadow)';
      document.body.appendChild(el);
    }
    el.textContent = msg;
    el.style.opacity='1';
    toastTO = setTimeout(()=> el.style.opacity='0', 2000);
  }

  // Initial render
  applyFilters();
</script>
</body>
</html>
